<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ğŸ”’ ADMIN PROTECTION -->
<script>
const ADMIN_EMAIL = "abhisekofficial31@gmail.com";
const currentUser = localStorage.getItem("email");

if (currentUser !== ADMIN_EMAIL) {
    window.location.href = "index.html";
}
</script>

<nav class="navbar">
    <div class="logo">ğŸ“ CampusConnect</div>
    <div class="nav-links">
        <a href="index.html">Events</a>
        <a href="registrations.html">My Registrations</a>
        <a class="active" href="admin.html">Admin Panel</a>
    </div>
</nav>

<section class="admin-section">

    <h2>Admin Dashboard</h2>
    <p>Manage events and track registrations.</p>

    <!-- ================= ADD EVENT ================= -->

    <div class="table-section">
        <h3>Add New Event</h3>

        <input type="text" id="title" placeholder="Event Title" required>
        <input type="date" id="date" required>
        <input type="time" id="time" required>
        <input type="text" id="location" placeholder="Location" required>
        <input type="file" id="image" accept="image/*">

        <button onclick="addEvent()">Add Event</button>
    </div>

    <br>

    <!-- ================= EVENTS LIST ================= -->

    <div class="table-section">
        <h3>All Events</h3>
        <div id="eventList"></div>
    </div>

    <br>

    <!-- ================= STATS ================= -->

    <div class="stats">
        <div class="stat-card">
            <h4>Total Events</h4>
            <h2 id="totalEvents">0</h2>
        </div>
    </div>

</section>

<script>

const API = "https://campusconnect-wasv.onrender.com";  // ğŸ”¥ LIVE URL

/* ================= ADD EVENT ================= */

async function addEvent() {

    const formData = new FormData();

    formData.append("title", document.getElementById("title").value);
    formData.append("date", document.getElementById("date").value);
    formData.append("time", document.getElementById("time").value);
    formData.append("location", document.getElementById("location").value);

    const imageFile = document.getElementById("image").files[0];
    if (imageFile) {
        formData.append("image", imageFile);
    }

    const res = await fetch(API + "/add-event", {
        method: "POST",
        body: formData
    });

    const data = await res.json();
    alert(data.message);

    document.getElementById("title").value = "";
    document.getElementById("date").value = "";
    document.getElementById("time").value = "";
    document.getElementById("location").value = "";
    document.getElementById("image").value = "";

    loadEvents();
}

/* ================= LOAD EVENTS ================= */

async function loadEvents() {

    const res = await fetch(API + "/events");
    const events = await res.json();

    const container = document.getElementById("eventList");
    container.innerHTML = "";

    document.getElementById("totalEvents").innerText = events.length;

    events.forEach(event => {

        container.innerHTML += `
            <div style="margin-bottom:15px;padding:15px;border:1px solid #ddd;border-radius:10px;">
                ${event.image ? 
                    `<img src="${API}${event.image}" style="width:100%;max-height:200px;object-fit:cover;border-radius:8px;margin-bottom:10px;">`
                    : ""
                }
                <h4>${event.title}</h4>
                <p>ğŸ“… ${event.date} | â° ${event.time}</p>
                <p>ğŸ“ ${event.location}</p>
                <button onclick="deleteEvent('${event._id}')">Delete</button>
            </div>
        `;
    });
}

/* ================= DELETE EVENT ================= */

async function deleteEvent(id) {

    await fetch(API + "/delete-event/" + id, {
        method: "DELETE"
    });

    loadEvents();
}

loadEvents();

</script>

</body>
</html>

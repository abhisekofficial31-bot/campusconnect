<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CampusConnect</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<script>
if (!localStorage.getItem("email")) {
    window.location.href = "signin.html";
}
</script>

<nav class="navbar">
    <div class="profile-container">
        <div class="profile-icon" onclick="toggleProfileMenu()">üë§</div>
        <div class="profile-dropdown" id="profileDropdown">
            <p id="dropdownName"></p>
            <p id="dropdownEmail" style="font-size:12px;color:gray;"></p>
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="logo">üéì CampusConnect</div>

    <div class="nav-links">
        <a href="index.html" class="active">Events</a>
        <a href="registrations.html">My Registrations</a>
        <a href="admin.html" id="adminLink">Admin Panel</a>
        <button onclick="toggleDarkMode()">üåô</button>
    </div>
</nav>

<section class="hero">
    <h1>Discover Your Campus <span>Experiences</span></h1>
    <p>From hackathons to cultural festivals and workshops.</p>
    <input type="text" placeholder="Search events..." class="search" onkeyup="filterEvents(this.value)">
</section>

<section class="events" id="eventsContainer">
    <p style="text-align:center;">Loading events...</p>
</section>

<div id="eventDetailModal" class="modal">
    <div class="modal-content" style="max-width:600px">
        <span class="close" onclick="closeDetailModal()">&times;</span>
        <img id="detailImage"
             style="width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:10px;margin-bottom:15px;">
        <h3 id="detailTitle"></h3>
        <p id="detailDate"></p>
        <p id="detailTime"></p>
        <p id="detailLocation"></p>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

    const API = "https://campusconnect-wasv.onrender.com";
    const ADMIN_EMAIL = "abhisekofficial31@gmail.com";
    let allEvents = [];

    const userName = localStorage.getItem("name");
    const userEmail = localStorage.getItem("email");

    if (userName && userEmail) {
        document.getElementById("dropdownName").innerText = "üë§ " + userName;
        document.getElementById("dropdownEmail").innerText = userEmail;
    }

    if (userEmail !== ADMIN_EMAIL) {
        document.getElementById("adminLink").style.display = "none";
    }

    async function loadEvents() {
        try {
            console.log("Fetching events from:", API + "/events");

            const response = await fetch(API + "/events");

            if (!response.ok) {
                throw new Error("Server error: " + response.status);
            }

            const data = await response.json();

            console.log("Events received:", data);

            allEvents = data;
            displayEvents(data);

        } catch (error) {
            console.error("Fetch error:", error);
            document.getElementById("eventsContainer").innerHTML =
                "<p style='text-align:center;color:red;'>Unable to load events. Refresh page.</p>";
        }
    }

    function displayEvents(events) {

        const container = document.getElementById("eventsContainer");
        container.innerHTML = "";

        if (!events || events.length === 0) {
            container.innerHTML =
                "<p style='text-align:center;'>No events available</p>";
            return;
        }

        events.forEach(event => {

            const imageUrl = event.image
                ? API + event.image
                : "https://via.placeholder.com/400x400?text=No+Image";

            const card = document.createElement("div");
            card.className = "card";

            card.innerHTML = `
                <img src="${imageUrl}"
                     onclick="openDetailModal(
                        '${imageUrl}',
                        '${event.title}',
                        '${event.date}',
                        '${event.time}',
                        '${event.location}'
                     )">

                <div class="card-content">
                    <h3>${event.title}</h3>
                    <p>üìÖ ${event.date}</p>
                    <p>‚è∞ ${event.time}</p>
                    <p>üìç ${event.location}</p>

                    <button class="register-btn"
                        onclick="registerEvent('${event.title}')">
                        Register Now
                    </button>
                </div>
            `;

            container.appendChild(card);
        });
    }

    window.registerEvent = function(eventName) {
        alert("Registered for: " + eventName);
    };

    window.filterEvents = function(value) {
        const filtered = allEvents.filter(event =>
            event.title.toLowerCase().includes(value.toLowerCase())
        );
        displayEvents(filtered);
    };

    window.openDetailModal = function(image, title, date, time, location) {
        document.getElementById("detailImage").src = image;
        document.getElementById("detailTitle").innerText = title;
        document.getElementById("detailDate").innerText = "üìÖ " + date;
        document.getElementById("detailTime").innerText = "‚è∞ " + time;
        document.getElementById("detailLocation").innerText = "üìç " + location;
        document.getElementById("eventDetailModal").style.display = "flex";
    };

    window.closeDetailModal = function() {
        document.getElementById("eventDetailModal").style.display = "none";
    };

    window.toggleProfileMenu = function() {
        const menu = document.getElementById("profileDropdown");
        menu.style.display =
            menu.style.display === "block" ? "none" : "block";
    };

    window.onclick = function(event) {
        if (!event.target.closest(".profile-container")) {
            document.getElementById("profileDropdown").style.display = "none";
        }
    };

    window.logout = function() {
        localStorage.clear();
        window.location.href = "signin.html";
    };

    window.toggleDarkMode = function() {
        document.body.classList.toggle("dark-mode");
    };

    loadEvents();
});
</script>

</body>
</html>




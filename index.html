<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CampusConnect</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ================= NAVBAR ================= -->
<nav class="navbar">
    <div class="nav-left">
        üéì <span class="logo-text">CampusConnect</span>
    </div>

    <div class="nav-right">
        <a href="#" class="nav-link active">Events</a>
        <a href="#" class="nav-link">My Registrations</a>
        <a href="admin.html" id="adminLink" class="nav-link">Admin Panel</a>
        <button onclick="toggleDarkMode()" class="dark-toggle">üåô</button>
    </div>
</nav>

<!-- ================= HERO ================= -->
<section class="hero">
    <h1>
        Discover Your Campus 
        <span class="highlight">Experiences</span>
    </h1>

    <p>
        From hackathons to cultural festivals and workshops.
    </p>

    <div class="search-wrapper">
        <input type="text"
               class="modern-search"
               placeholder="üîç Search events..."
               onkeyup="filterEvents(this.value)">
    </div>
</section>

<!-- ================= EVENTS ================= -->
<section class="events-section">
    <div id="eventsContainer" class="events-grid"></div>
</section>

<!-- ================= MODAL ================= -->
<div id="eventDetailModal" class="modal">
    <div class="modal-content">
        <img id="detailImage">
        <h3 id="detailTitle"></h3>
        <p id="detailDate"></p>
        <p id="detailTime"></p>
        <p id="detailLocation"></p>
        <button onclick="closeDetailModal()">Close</button>
    </div>
</div>

<!-- ================= SCRIPT ================= -->
<script>
document.addEventListener("DOMContentLoaded", function() {

    const API = "http://localhost:5000";
    const ADMIN_EMAIL = "abhisekofficial31@gmail.com";

    let allEvents = [];
    const container = document.getElementById("eventsContainer");

    const userEmail = localStorage.getItem("email");
    const userName = localStorage.getItem("name");

    /* Hide Admin Panel for non-admin */
    if (userEmail !== ADMIN_EMAIL) {
        document.getElementById("adminLink").style.display = "none";
    }

    /* Load Events */
    async function loadEvents() {
        try {
            const response = await fetch(API + "/events");
            const data = await response.json();
            allEvents = data;
            displayEvents(data);
        } catch (error) {
            container.innerHTML =
                "<p style='text-align:center;color:red;'>Unable to load events.</p>";
        }
    }

    /* Display Events */
    function displayEvents(events) {
        container.innerHTML = "";

        if (!events || events.length === 0) {
            container.innerHTML =
                "<p style='text-align:center;'>No events available</p>";
            return;
        }

        events.forEach(event => {

            const imageUrl = event.image
                ? API + event.image
                : "https://via.placeholder.com/400x400?text=No+Image";

            const card = document.createElement("div");
            card.className = "card";

            card.innerHTML = `
                <img src="${imageUrl}" 
                     onclick="openDetailModal(
                        '${imageUrl}',
                        '${event.title}',
                        '${event.date}',
                        '${event.time}',
                        '${event.location}'
                     )">

                <div class="card-content">
                    <h3>${event.title}</h3>
                    <p>üìÖ ${event.date}</p>
                    <p>‚è∞ ${event.time}</p>
                    <p>üìç ${event.location}</p>

                    <button class="register-btn"
                        onclick="handleRegister('${event._id}', '${event.externalLink || ""}')">
                        Register Now
                    </button>
                </div>
            `;

            container.appendChild(card);
        });
    }

    /* Smart Register Logic */
    window.handleRegister = function(eventId, link) {

        if (link && link.trim() !== "") {
            // External registration
            window.open(link, "_blank");
        } else {
            // Local registration
            if (!userEmail || !userName) {
                alert("Please login first.");
                return;
            }

            fetch(API + "/register/" + eventId, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    name: userName,
                    email: userEmail
                })
            })
            .then(res => res.json())
            .then(data => alert(data.message))
            .catch(() => alert("Registration failed"));
        }
    };

    /* Search */
    window.filterEvents = function(value) {
        const filtered = allEvents.filter(event =>
            event.title.toLowerCase().includes(value.toLowerCase())
        );
        displayEvents(filtered);
    };

    /* Modal */
    window.openDetailModal = function(image, title, date, time, location) {
        document.getElementById("detailImage").src = image;
        document.getElementById("detailTitle").innerText = title;
        document.getElementById("detailDate").innerText = "üìÖ " + date;
        document.getElementById("detailTime").innerText = "‚è∞ " + time;
        document.getElementById("detailLocation").innerText = "üìç " + location;
        document.getElementById("eventDetailModal").style.display = "flex";
    };

    window.closeDetailModal = function() {
        document.getElementById("eventDetailModal").style.display = "none";
    };

    window.toggleDarkMode = function() {
        document.body.classList.toggle("dark-mode");
    };

    loadEvents();
});
</script>

</body>
</html>




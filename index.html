<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CampusConnect</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- üîê LOGIN CHECK -->
<script>
if (!localStorage.getItem("email")) {
    window.location.href = "signin.html";
}
</script>

<!-- NAVBAR -->
<nav class="navbar">

    <!-- üë§ PROFILE ICON -->
    <div class="profile-container">
        <div class="profile-icon" onclick="toggleProfileMenu()">
            üë§
        </div>

        <div class="profile-dropdown" id="profileDropdown">
            <p id="dropdownName"></p>
            <p id="dropdownEmail" style="font-size:12px;color:gray;"></p>
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="logo">üéì CampusConnect</div>

    <div class="nav-links">
        <a href="index.html" class="active">Events</a>
        <a href="registrations.html">My Registrations</a>
        <a href="admin.html" id="adminLink">Admin Panel</a>
        <button onclick="toggleDarkMode()">üåô</button>
    </div>

</nav>

<!-- HERO -->
<section class="hero">
    <h1>Discover Your Campus <span>Experiences</span></h1>
    <p>From hackathons to cultural festivals and workshops.</p>
    <input type="text" placeholder="Search events..." class="search" onkeyup="filterEvents(this.value)">
</section>

<!-- EVENTS -->
<section class="events" id="eventsContainer"></section>

<!-- EVENT DETAIL MODAL -->
<div id="eventDetailModal" class="modal">
    <div class="modal-content" style="max-width:600px">
        <span class="close" onclick="closeDetailModal()">&times;</span>

        <img id="detailImage"
             style="width:100%;aspect-ratio:1/1;object-fit:cover;border-radius:10px;margin-bottom:15px;">

        <h3 id="detailTitle"></h3>
        <p id="detailDate"></p>
        <p id="detailTime"></p>
        <p id="detailLocation"></p>
    </div>
</div>

<!-- SOCKET -->
<script src="https://campusconnect-wasv.onrender.com/socket.io/socket.io.js"></script>

<script>

document.addEventListener("DOMContentLoaded", function() {

    const API = "https://campusconnect-wasv.onrender.com";
    const ADMIN_EMAIL = "abhisekofficial31@gmail.com";

    let allEvents = [];

    /* USER INFO */
    const userName = localStorage.getItem("name");
    const userEmail = localStorage.getItem("email");

    if (userName && userEmail) {
        document.getElementById("dropdownName").innerText = "üë§ " + userName;
        document.getElementById("dropdownEmail").innerText = userEmail;
    }

    /* Hide Admin Link */
    if (userEmail !== ADMIN_EMAIL) {
        document.getElementById("adminLink").style.display = "none";
    }

    /* LOAD EVENTS */
    async function loadEvents() {
        const res = await fetch(`${API}/events`);
        const events = await res.json();
        allEvents = events;
        displayEvents(events);
    }

    /* DISPLAY EVENTS */
    function displayEvents(events) {

        const container = document.getElementById("eventsContainer");
        container.innerHTML = "";

        if (events.length === 0) {
            container.innerHTML = "<p style='text-align:center;'>No events available</p>";
            return;
        }

        events.forEach(event => {
            container.innerHTML += `
                <div class="card">
                    ${event.image ?
                        `<img src="${API}${event.image}"
                         onclick="openDetailModal(
                            '${API}${event.image}',
                            '${event.title}',
                            '${event.date}',
                            '${event.time}',
                            '${event.location}'
                         )">`
                        :
                        `<img src="https://via.placeholder.com/400x400?text=No+Image">`
                    }
                    <div class="card-content">
                        <h3>${event.title}</h3>
                        <p>üìÖ ${event.date}</p>
                        <p>‚è∞ ${event.time}</p>
                        <p>üìç ${event.location}</p>
                    </div>
                </div>
            `;
        });
    }

    /* FILTER */
    window.filterEvents = function(value) {
        const filtered = allEvents.filter(event =>
            event.title.toLowerCase().includes(value.toLowerCase())
        );
        displayEvents(filtered);
    }

    /* DETAIL MODAL */
    window.openDetailModal = function(image, title, date, time, location) {
        document.getElementById("detailImage").src = image;
        document.getElementById("detailTitle").innerText = title;
        document.getElementById("detailDate").innerText = "üìÖ " + date;
        document.getElementById("detailTime").innerText = "‚è∞ " + time;
        document.getElementById("detailLocation").innerText = "üìç " + location;
        document.getElementById("eventDetailModal").style.display = "flex";
    }

    window.closeDetailModal = function() {
        document.getElementById("eventDetailModal").style.display = "none";
    }

    /* PROFILE MENU */
    window.toggleProfileMenu = function() {
        const menu = document.getElementById("profileDropdown");
        menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    window.logout = function() {
        localStorage.clear();
        window.location.href = "signin.html";
    }

    window.onclick = function(event) {
        if (!event.target.closest(".profile-container")) {
            document.getElementById("profileDropdown").style.display = "none";
        }
    }

    /* DARK MODE */
    window.toggleDarkMode = function() {
        document.body.classList.toggle("dark-mode");
    }

    /* SOCKET */
    const socket = io(API);
    socket.on("newNotification", (message) => {
        alert(message);
    });

    loadEvents();
});

</script>

</body>
</html>



